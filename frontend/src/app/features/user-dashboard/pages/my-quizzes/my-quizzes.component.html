<div class="container mx-auto px-4 py-6">
  <!-- Welcome Section -->
  <div class="mb-8 mt-4">
    <h1 class="text-2xl font-bold text-gray-900">My Quiz History</h1>
    <p class="mt-2 text-gray-600">Track your progress and improve your performance</p>

    <div class="flex flex-wrap gap-3 justify-end">
      <button routerLink="/genaiquiz" class="flex items-center px-4 py-2 bg-gray-600 rounded-full text-white hover:bg-indigo-700 whitespace-nowrap">
        <svg fill="none" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 animate-pulse " viewBox="0 0 16 16">
  
          <path
            d="M16 8.016A8.522 8.522 0 008.016 16h-.032A8.521 8.521 0 000 8.016v-.032A8.521 8.521 0 007.984 0h.032A8.522 8.522 0 0016 7.984v.032z"
            fill="url(#prefix__paint0_radial_980_20147)" />
          <defs>
            <radialGradient id="prefix__paint0_radial_980_20147" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
              gradientTransform="matrix(16.1326 5.4553 -43.70045 129.2322 1.588 6.503)">
              <stop offset=".067" stop-color="#9168C0" />
              <stop offset=".343" stop-color="#5684D1" />
              <stop offset=".672" stop-color="#1BA1E3" />
            </radialGradient>
          </defs>
        </svg>
        creat quiz with Gen-AI
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline">{{ error }}</span>
  </div>

  

  <!-- Content Grid -->
  <div *ngIf="!isLoading && !error" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column: Quiz History -->
    <div class="lg:col-span-2">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900">Quiz History</h2>
      </div>

      <div *ngIf="userResponses.length === 0" class="text-center py-10 bg-white rounded-lg shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
        <p class="mt-2 text-gray-500">You haven't taken any quizzes yet.</p>
      </div>

      <div *ngIf="userResponses.length > 0" class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8">
        <div *ngFor="let response of userResponses"
          class="bg-white rounded-lg shadow-sm overflow-hidden transition-transform hover:shadow-md hover:-translate-y-1">
          <div class="p-4 sm:p-6">
            <div class="flex flex-wrap gap-2 mb-3">
              <span class="px-2 py-1 text-xs font-medium bg-indigo-100 text-blue-800 rounded">
                {{ response.quiz.category.name }}
              </span>
              <span class="px-2 py-1 text-xs font-medium rounded {{ getStatusClass(response.status) }}">
                {{ response.status | titlecase }}
              </span>
            </div>

            <h3 class="text-lg font-bold text-gray-900 mb-3">
              {{ response.quiz.title }}
            </h3>

            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center">
                <span class="text-sm font-medium">
                  Score: {{ response.totalScore }} points
                </span>
              </div>
              <span class="text-sm text-gray-600">
                {{ response.completedAt | date:'mediumDate' }}
              </span>
            </div>

            <button [routerLink]="['/reviewquiz', response._id]"
              class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 32 32" fill="currentColor">
                <path *ngIf="response.status === 'completed'" fill-rule="evenodd"
                  d="M30.913,17.694c0.013-0.393,0.024-0.787,0.018-1.182c-0.01-0.572-0.076-1.14-0.091-1.712
                c-0.01-0.357-0.006-0.714-0.019-1.072c-0.01-0.357-0.029-0.713-0.037-1.07c-0.017-0.772-0.021-1.545-0.01-2.317
                c0.008-0.727,0.035-1.454-0.01-2.179c-0.043-0.721-0.132-1.454-0.39-2.133c-0.316-0.83-0.838-1.596-1.619-2.044
                c-0.398-0.228-0.848-0.27-1.298-0.27c-0.197,0-0.394,0.008-0.587,0.012c-0.304,0.004-0.607,0.025-0.911,0.045
                c-0.425,0.027-0.783,0.334-0.783,0.783c0,0.403,0.357,0.818,0.783,0.785c0.589-0.045,1.178-0.116,1.768-0.07
                c0.081,0.017,0.16,0.037,0.239,0.062c0.076,0.04,0.148,0.084,0.22,0.133c0.104,0.092,0.201,0.192,0.291,0.297
                c0.145,0.207,0.277,0.42,0.385,0.648c0.131,0.357,0.239,0.721,0.302,1.097c0.067,0.645,0.07,1.296,0.072,1.944
                c0.002,0.774-0.021,1.551-0.021,2.325c0,0.725,0.014,1.45,0.027,2.175c0.012,0.646,0.025,1.291,0.074,1.935
                c0.031,0.401,0.034,0.803,0.034,1.205c-0.119,0-0.237-0.004-0.356-0.003c-0.184,0-0.368,0.002-0.551,0
                c-0.613-0.004-1.227,0.004-1.84,0.004c-0.702,0-1.406-0.008-2.108,0.002c-0.363,0.006-0.725,0.004-1.086,0.002
                c-0.411-0.002-0.822-0.004-1.231,0.002c-0.465,0.01-0.927,0.006-1.392,0.006c-0.473,0-0.946-0.048-1.419-0.054
                c-0.004,0-0.007,0-0.011,0c-0.154,0-0.291,0.056-0.416,0.131c-0.162,0.009-0.322,0.025-0.483,0.042
                c-0.637-0.336-1.323-0.596-2.05-0.596c-0.053,0-0.107,0.001-0.161,0.004c-0.719,0.036-1.381,0.333-1.927,0.788
                c-0.105-0.118-0.247-0.222-0.393-0.241c-0.75-0.107-1.514-0.103-2.274-0.101c-0.233,0-0.467,0.002-0.698-0.002
                c-0.628-0.008-1.256-0.027-1.883-0.031c-0.787-0.004-1.576-0.019-2.362-0.023c-0.789-0.006-1.576-0.014-2.364-0.017
                c-0.032,0-0.064,0-0.095,0c-0.306,0-0.608,0.01-0.915,0.04c-0.195,0.019-0.392,0.034-0.588,0.047
                c0.002-0.334,0.012-0.668,0.005-1.002c-0.016-0.713-0.05-1.427-0.07-2.142c-0.023-0.751-0.062-1.503-0.076-2.255
                c-0.014-0.808,0.029-1.617,0.089-2.422c0.045-0.592,0.053-1.185,0.109-1.775c0.049-0.287,0.137-0.567,0.238-0.84
                c0.092-0.2,0.196-0.391,0.321-0.574c0.03-0.034,0.061-0.065,0.094-0.096c0.086-0.056,0.177-0.104,0.27-0.149
                C3.884,5.784,4.044,5.74,4.21,5.714c0.177-0.022,0.355-0.041,0.533-0.048C5.071,5.651,5.403,5.67,5.732,5.67
                c0.456,0.002,0.836-0.38,0.836-0.834c0-0.444-0.372-0.834-0.822-0.834c-0.005,0-0.009,0-0.014,0C5.331,4.007,4.931,4.018,4.53,4.051
                C4.148,4.082,3.76,4.123,3.39,4.232c-0.403,0.12-0.77,0.326-1.084,0.603C2.141,4.98,2.007,5.184,1.891,5.372
                C1.757,5.589,1.653,5.818,1.556,6.056C1.393,6.45,1.292,6.863,1.236,7.284c-0.05,0.38-0.064,0.766-0.078,1.148
                c-0.029,0.791-0.103,1.58-0.124,2.373c-0.016,0.63-0.025,1.264-0.002,1.896c0.021,0.638,0.056,1.276,0.064,1.914
                c0.008,0.591,0.06,1.177,0.072,1.768c0.011,0.42,0.007,0.841,0.008,1.262c-0.111,0.142-0.189,0.308-0.174,0.495
                c0.027,0.326,0.06,0.652,0.081,0.979c0.017,0.262,0.006,0.524,0.006,0.787c0,0.231,0.01,0.462,0.056,0.689
                c0.052,0.267,0.244,0.519,0.473,0.657c0.125,0.076,0.261,0.116,0.402,0.14c0.052,0.51,0.103,1.02,0.134,1.531
                c0.025,0.405,0.066,0.805,0.138,1.204c0.06,0.333,0.169,0.659,0.289,0.973c0.194,0.51,0.421,0.991,0.828,1.369
                c0.287,0.264,0.632,0.494,0.981,0.669c0.291,0.145,0.589,0.25,0.907,0.318c0.284,0.062,0.573,0.094,0.862,0.131
                c0.671,0.1,1.342,0.159,2.023,0.137c0.196-0.008,0.39-0.004,0.586-0.025c0.225-0.022,0.45-0.054,0.674-0.085
                c0.596-0.073,1.213-0.159,1.752-0.442c0.277-0.145,0.557-0.289,0.816-0.465c0.341-0.233,0.642-0.508,0.906-0.826
                c0.26-0.31,0.448-0.667,0.63-1.026c0.186-0.374,0.347-0.756,0.494-1.148c0.056-0.153,0.114-0.303,0.165-0.458
                c0.058-0.169,0.091-0.347,0.132-0.521c0.037-0.163,0.078-0.324,0.114-0.487c0.052-0.25,0.07-0.51,0.097-0.762
                c0.031-0.277,0.062-0.553,0.081-0.832c0.014-0.222,0.026-0.443,0.048-0.664c0.048-0.282,0.103-0.563,0.131-0.848
                c0.009-0.098,0.019-0.196,0.028-0.294c0.118-0.034,0.231-0.086,0.322-0.177c0.039-0.038,0.077-0.075,0.116-0.111
                c0.122-0.088,0.251-0.167,0.386-0.233c0.117-0.042,0.238-0.076,0.361-0.101c0.183-0.012,0.362-0.011,0.545,0.004
                c0.176,0.036,0.345,0.095,0.512,0.162c0.065,0.031,0.127,0.067,0.191,0.1c0,0.045-0.004,0.091-0.001,0.135
                c0.01,0.165,0.01,0.333,0.014,0.498c0.008,0.372,0.016,0.739,0.006,1.111c-0.019,0.774-0.017,1.547,0.023,2.321
                c0.043,0.878,0.372,1.698,0.702,2.499c0.188,0.454,0.427,0.859,0.733,1.241c0.302,0.378,0.624,0.733,1.008,1.026
                c0.392,0.302,0.851,0.508,1.305,0.7c0.351,0.146,0.702,0.21,1.08,0.244c0.343,0.033,0.686,0.025,1.03,0.014
                c0.384-0.01,0.77-0.019,1.152-0.056c0.421-0.041,0.847-0.099,1.255-0.204c0.388-0.101,0.766-0.283,1.115-0.481
                c0.289-0.163,0.545-0.38,0.803-0.586c0.229-0.18,0.456-0.363,0.679-0.551c0.454-0.384,0.799-0.888,1.055-1.423
                c0.252-0.527,0.357-1.09,0.442-1.664c0.091-0.629,0.126-1.261,0.201-1.892c0.02-0.144,0.041-0.286,0.072-0.427
                c0.097-0.007,0.193-0.016,0.291-0.033c0.339-0.058,0.611-0.322,0.708-0.646c0.045-0.146,0.041-0.295,0.039-0.446
                c-0.012-0.605,0.017-1.208,0.014-1.813C30.999,17.923,30.965,17.804,30.913,17.694z M12.951,19.844
                c-0.023,0.237-0.033,0.473-0.039,0.71c-0.014,0.457-0.027,0.915-0.072,1.37c-0.052,0.324-0.128,0.648-0.213,0.963
                c-0.092,0.354-0.206,0.711-0.342,1.051c-0.143,0.331-0.293,0.666-0.497,0.963c-0.143,0.168-0.299,0.323-0.469,0.465
                c-0.268,0.184-0.559,0.335-0.856,0.47c-0.3,0.107-0.623,0.154-0.938,0.198c-0.228,0.027-0.456,0.05-0.684,0.082
                c0.07-0.01,0.14-0.019,0.211-0.029c-0.75,0.098-1.521,0.088-2.271,0.002c-0.275-0.043-0.556-0.081-0.826-0.138
                c-0.198-0.041-0.394-0.081-0.584-0.148c-0.233-0.113-0.448-0.252-0.659-0.403c-0.091-0.076-0.177-0.157-0.26-0.244
                c-0.117-0.178-0.211-0.371-0.299-0.566c-0.166-0.421-0.287-0.848-0.361-1.293c-0.088-0.864-0.104-1.735-0.178-2.599
                c-0.019-0.229-0.076-0.423-0.244-0.591c-0.155-0.155-0.37-0.244-0.589-0.244c-0.011,0-0.021,0.006-0.032,0.006
                c-0.002-0.132-0.001-0.264-0.004-0.395c-0.005-0.231-0.013-0.46-0.016-0.69c0.18-0.024,0.359-0.048,0.538-0.072
                c-0.074,0.01-0.149,0.021-0.223,0.031c0.686-0.089,1.386-0.072,2.075-0.076c0.812-0.004,1.623-0.012,2.437-0.019
                c0.76-0.004,1.522-0.016,2.284-0.008c0.651,0.008,1.307,0.008,1.958,0.05c0.314,0.021,0.626,0.039,0.94,0.056
                c0.117,0.006,0.234,0.015,0.351,0.021c-0.006,0.095-0.004,0.19-0.015,0.285C13.032,19.315,12.975,19.576,12.951,19.844z
                 M29.23,19.488c-0.171,0.064-0.326,0.138-0.452,0.279c-0.147,0.163-0.225,0.355-0.277,0.566c-0.054,0.208-0.068,0.427-0.091,0.642
                c-0.08,0.701-0.119,1.406-0.198,2.107c-0.062,0.399-0.148,0.802-0.292,1.179c-0.097,0.204-0.204,0.404-0.333,0.59
                c-0.183,0.207-0.379,0.391-0.595,0.562c-0.113,0.087-0.226,0.173-0.339,0.26c-0.339,0.257-0.676,0.498-1.062,0.678
                c-0.424,0.16-0.857,0.246-1.305,0.314c-0.302,0.03-0.609,0.041-0.912,0.051c-0.301,0.008-0.602,0.008-0.901-0.022
                c-0.121-0.019-0.241-0.038-0.36-0.058c-0.177-0.031-0.348-0.086-0.516-0.151c-0.33-0.147-0.66-0.301-0.958-0.506
                c-0.268-0.227-0.505-0.493-0.731-0.763c-0.128-0.175-0.245-0.354-0.352-0.544c-0.111-0.198-0.199-0.412-0.286-0.623
                c-0.189-0.456-0.366-0.907-0.454-1.395c-0.069-0.699-0.086-1.417-0.044-2.119c0.021-0.343,0.035-0.688,0.06-1.031
                c0.018-0.252,0.022-0.508,0.04-0.76c0.079-0.011,0.158-0.02,0.234-0.031c-0.068,0.01-0.138,0.019-0.206,0.029
                c0.084-0.012,0.169-0.019,0.253-0.025c0.07,0.019,0.138,0.043,0.213,0.042c0.399-0.004,0.795-0.025,1.194-0.033
                c0.209-0.002,0.421-0.002,0.632-0.002c0.126,0,0.252,0,0.38-0.002c0.747-0.002,1.497-0.019,2.245-0.035
                c0.745-0.014,1.493-0.029,2.241-0.014c0.622,0.01,1.241,0.033,1.863,0.031c0.457-0.001,0.914-0.004,1.372-0.007
                c0.004,0.177,0.008,0.355,0.012,0.533c0.002,0.077,0.006,0.154,0.01,0.231C29.286,19.469,29.258,19.478,29.23,19.488z
                 M11.873,21.133c0.138,0.138,0.264,0.378,0.242,0.58c-0.037,0.299-0.062,0.609-0.138,0.9c-0.056,0.21-0.14,0.407-0.227,0.607
                c-0.134,0.32-0.328,0.62-0.537,0.896c-0.178,0.238-0.366,0.469-0.597,0.659c-0.341,0.283-0.739,0.454-1.156,0.59
                c-0.394,0.13-0.83-0.146-0.938-0.531c-0.105-0.388,0.128-0.843,0.533-0.938c0.087-0.02,0.174-0.04,0.258-0.066
                c0.094-0.047,0.185-0.101,0.273-0.158c0.099-0.088,0.191-0.186,0.277-0.287c0.17-0.237,0.314-0.494,0.435-0.759
                c0.055-0.148,0.1-0.298,0.131-0.452c0.012-0.154,0.025-0.307,0.041-0.462c0.025-0.225,0.076-0.415,0.242-0.58
                c0.153-0.155,0.363-0.241,0.58-0.241C11.51,20.892,11.721,20.978,11.873,21.133z M27.631,21.786c-0.01,0.347-0.014,0.704-0.06,1.049
                c-0.056,0.423-0.157,0.807-0.384,1.177c-0.225,0.368-0.529,0.688-0.849,0.975c-0.161,0.142-0.326,0.281-0.514,0.386
                c-0.112,0.064-0.225,0.12-0.337,0.182c-0.45,0.25-1.032,0.029-1.171-0.475c-0.058-0.207-0.027-0.429,0.081-0.615
                c0.112-0.192,0.275-0.287,0.475-0.366c0.006-0.002,0.013-0.005,0.019-0.007c0.09-0.044,0.176-0.094,0.259-0.15
                c0.168-0.151,0.324-0.316,0.467-0.492c0.088-0.125,0.167-0.251,0.235-0.388c0.026-0.08,0.049-0.159,0.067-0.241
                c0.024-0.342-0.003-0.692,0.003-1.034c0.006-0.467,0.384-0.855,0.855-0.855C27.233,20.932,27.646,21.32,27.631,21.786z" clip-rule="evenodd" />
                <path *ngIf="response.status !== 'completed'" fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                  clip-rule="evenodd" />
              </svg>
              {{ response.status === 'completed' ? 'Review Quiz' :
              response.status === 'started' ? 'Continue Quiz' : 'Start Quiz' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Performance Stats -->
    <div class="lg:col-span-1">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900">Performance by Category</h2>
      </div>

      <!-- Category Performance -->
      <div
        *ngIf="!dashboardLoading && dashboardData && dashboardData.categoryPerformance && dashboardData.categoryPerformance.length > 0"
        class="bg-white p-6 rounded-lg shadow-sm">
        <div *ngFor="let category of dashboardData.categoryPerformance" class="mb-6 last:mb-0">
          <div class="flex justify-between mb-2">
            <span class="text-gray-800 font-medium">{{ category.categoryName }}</span>
            <span class="font-medium" [ngClass]="{
                    'text-green-600': category.avgScore >= 80, 
                    'text-yellow-600': category.avgScore >= 60 && category.avgScore < 80,
                    'text-red-600': category.avgScore < 60
                  }">
              {{ category.avgScore | number:'1.0-1' }}%
            </span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
            <div class="h-3 rounded-full transition-all duration-500" [ngClass]="{
                   'bg-green-500': category.avgScore >= 80, 
                   'bg-yellow-500': category.avgScore >= 60 && category.avgScore < 80,
                   'bg-red-500': category.avgScore < 60
                 }" [style.width.%]="category.avgScore"></div>
          </div>
          <div class="grid grid-cols-2 text-sm">
            <div class="text-gray-600">Completed: <span class="font-medium">{{ category.count }}</span></div>
            <div class="text-gray-600 text-right">Available: <span class="font-medium">{{
                category.totalQuizzesInCategory }}</span></div>
          </div>
        </div>
      </div>

      <!-- Dashboard loading state -->
      <div *ngIf="dashboardLoading" class="bg-white p-6 rounded-lg shadow-sm">
        <div class="flex justify-center items-center h-32">
          <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div>
        </div>
      </div>

      <!-- No performance data yet -->
      <div
        *ngIf="!dashboardLoading && (!dashboardData || !dashboardData.categoryPerformance || dashboardData.categoryPerformance.length === 0)"
        class="bg-white p-6 rounded-lg shadow-sm">
        <div class="text-center py-8">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          <p class="mt-2 text-gray-600">Complete quizzes to see your performance statistics by category.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Review Popup -->

</div>